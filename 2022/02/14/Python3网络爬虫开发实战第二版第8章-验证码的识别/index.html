<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Lhj">
    
    <title>
        
        Alexander
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Alexander
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                NOTE
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">NOTE</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation"></span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Lhj</span>
                        
                            <span class="author-label">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-02-14 23:35:14</span>
        <span class="mobile">2022-02-14 23:35</span>
    </span>
    
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>5.2k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>20 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h3 id="使用OCR技术识别图片验证码"><a href="#使用OCR技术识别图片验证码" class="headerlink" title="使用OCR技术识别图片验证码"></a>使用OCR技术识别图片验证码</h3><p>首先来看最简单的一种验证码—图形验证码，这个比较常见，一般由四位数字组成，例如在案例网站<a class="link"   target="_blank" rel="noopener" href="https://captcha7.scrape.center/%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E7%B1%BB%E4%BC%BC%E7%9A%84%E9%AA%8C%E8%AF%81%E7%A0%81%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA" >https://captcha7.scrape.center/就可以看到类似的验证码，如下图所示<i class="fas fa-external-link-alt"></i></a>:</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/HcmDtx"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://s4.ax1x.com/2022/02/14/HcmDtx.png"
                      alt="HcmDtx.png"
                ></a><br>对于图片上的验证码，这种类型整体比较规整，没有过多的干扰线和干扰点，蚊子也没有大幅度的变形和旋转，对于这类验证码，可以使用OCR技术识别</p>
<h4 id="OCR技术"><a href="#OCR技术" class="headerlink" title="OCR技术"></a>OCR技术</h4><p>OCR，即Optical Character Recognition，意为光学字符识别，是指利用电子设备检查打印在纸上的字符，通过检查亮暗模式确定字符形状，然后使用字符识别方法将形状转换为计算机文字，现在OCR已经广泛应用于生产生活中，如文档识别、证件识别、字幕识别、文档检索等；当然用来识别这里描述的图形验证码也没有问题</p>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>这里需要导入tesserocr库，这个库的安装相对来说没有那么简单，可以参考<a class="link"   target="_blank" rel="noopener" href="https://setup.scrape.center/tesserocr%EF%BC%8C%E5%8F%A6%E5%A4%96%EF%BC%8C%E8%BF%98%E9%9C%80%E8%A6%81%E5%AE%89%E8%A3%85Selenium%E3%80%81Pillow%E3%80%81NumPy%E5%92%8Cretrying%E5%BA%93%EF%BC%8C%E7%94%A8%E6%9D%A5%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95%E3%80%81%E5%A4%84%E7%90%86%E5%9B%BE%E5%83%8F%E5%92%8C%E9%87%8D%E8%AF%95%E6%93%8D%E4%BD%9C%EF%BC%8C%E8%BF%99%E4%BA%9B%E5%8F%AF%E4%BD%BF%E7%94%A8pip%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85" >https://setup.scrape.center/tesserocr，另外，还需要安装Selenium、Pillow、NumPy和retrying库，用来模拟登录、处理图像和重试操作，这些可使用pip工具安装<i class="fas fa-external-link-alt"></i></a>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install selenium pillow numpy retrying</span><br></pre></td></tr></table></figure>

<p>如果安装过程中出现了问题，可参考如下链接:</p>
<ul>
<li>Selenium: <a class="link"   target="_blank" rel="noopener" href="https://setup.scrape.center/selenium" >https://setup.scrape.center/selenium<i class="fas fa-external-link-alt"></i></a></li>
<li>Pillow: <a class="link"   target="_blank" rel="noopener" href="https://setup.scrape.center/pillow" >https://setup.scrape.center/pillow<i class="fas fa-external-link-alt"></i></a></li>
<li>Numpy: <a class="link"   target="_blank" rel="noopener" href="https://setup.scrape.center/numpy" >https://setup.scrape.center/numpy<i class="fas fa-external-link-alt"></i></a></li>
<li>retrying: <a class="link"   target="_blank" rel="noopener" href="https://setup.scrape.center/retrying" >https://setup.scrape.center/retrying<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<h4 id="保存验证码图片"><a href="#保存验证码图片" class="headerlink" title="保存验证码图片"></a>保存验证码图片</h4><p>我们需要先保存上图中的图片到本地，在浏览器中打开上面的案例网站，然后右键点击验证码图片，将其保存为captcha.png文件即可</p>
<h4 id="识别测试"><a href="#识别测试" class="headerlink" title="识别测试"></a>识别测试</h4><p>这部分比较简单，直接上代码叭:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tesserocr</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">image = Image.<span class="built_in">open</span>(<span class="string">&#x27;captcha.png&#x27;</span>)</span><br><span class="line">result = tesserocr.image_to_text(image)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>这里新建了一个图片对象，然后调用了tesserocr里的image_to_text方法将图片转换为了文本，此过程就是对验证码的识别过程，tesserocr还提供了一个更加方便的方法，可以直接将图片转化为字符串:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tesserorc</span><br><span class="line"><span class="built_in">print</span>(tesserocr.file_to_text(<span class="string">&#x27;captcha.png&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="识别误差的处理"><a href="#识别误差的处理" class="headerlink" title="识别误差的处理"></a>识别误差的处理</h4><p>以上所用的是一张干扰不太大的验证码，如果有干扰点的话就会出现识别误差，甚至会直接识别不出来，如下状况所示:</p>
<p>以下代码我们使用这个验证码: <a class="link"   target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/stormwasd/image-hosting@master/20220214/%E4%B8%8B%E8%BD%BD.3la0ki1sok20.webp" >https://cdn.jsdelivr.net/gh/stormwasd/image-hosting@master/20220214/下载.3la0ki1sok20.webp<i class="fas fa-external-link-alt"></i></a></p>
<p>代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tesserocr</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">image = Image.<span class="built_in">open</span>(<span class="string">r&#x27;C:\Users\Public\Pictures\Sample Pictures\test1.png&#x27;</span>)</span><br><span class="line">result = tesserocr.image_to_text(image)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/stormwasd/image-hosting@master/20220215/Snipaste_2022-02-15_15-11-41.3bf900jvwg40.webp"
                      alt="Snipaste_2022-02-15_15-11-41"
                ></p>
<p>可以看到这里什么也没输出，这是由于干扰项的存在，我们需要先处理下验证码，仔细观察可以发发现，图片里那些造成干扰的点，其颜色大多比文本的颜色更浅，因此我们可以通过颜色将造成干扰的点排除掉</p>
<p>首先将保存的验证码图片转化为数组，看一下维度:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tesserocr</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">image = Image.<span class="built_in">open</span>(<span class="string">r&#x27;C:\Users\Public\Pictures\Sample Pictures\test.png&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(np.array(image).shape)</span><br><span class="line"><span class="built_in">print</span>(image.mode)</span><br></pre></td></tr></table></figure>

<p>运行结果如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(38, 112, 4)</span><br><span class="line">RGBA</span><br></pre></td></tr></table></figure>

<p>从结果可以看出，这个图片是一个三维数组，38和112代表图片的宽和高，4则是每个像素点的表示向量。为什么是4呢，因为最后一维是一个长度为4的数组，分别代表R(红色)，G(绿色)，b(蓝色)，A(透明度)，即一个像素点由四个数字表示，那么为什么是RGBA呢，因为image.mode是RGBA，即有透明通道的真彩色，运行结果的第二行也可以印证这一点</p>
<p>mode属性定义了图片的类型和像素的位宽，一共有9种，这个自行百度</p>
<p>为了方便处理，可以把RGBA转为更简单的L，即把图片转为灰度图像，可用如下代码实现:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image = image.convert(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">image.show()</span><br></pre></td></tr></table></figure>

<p>也可以把图片二值化:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image = image.convert(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">image.show()</span><br></pre></td></tr></table></figure>

<p>我们这里把图片转化为灰度图像，然后根据阈值删除图片中的干扰点，代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">image = Image.<span class="built_in">open</span>(<span class="string">r&#x27;C:\Users\Public\Pictures\Sample Pictures\test1.png&#x27;</span>)</span><br><span class="line">iamge = image.convert(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">threshold = <span class="number">50</span>  <span class="comment"># 灰度的阈值</span></span><br><span class="line">array = np.array(image)  <span class="comment"># 图片转化为numpy数组</span></span><br><span class="line">arrpy = np.where(array &gt; threshold, <span class="number">255</span>, <span class="number">0</span>)  <span class="comment"># 对数组进行筛选和处理，其中指定将灰度大于阈值的图片的像素设置为255，表示白色，否则为0，表示黑色</span></span><br><span class="line">image = Image.formarray(array.astype(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">image.show()</span><br></pre></td></tr></table></figure>

<p>运行效果如下，如果感觉还没到预期也可以调整下阈值:</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/stormwasd/image-hosting@master/20220215/Snipaste_2022-02-15_15-44-11.1o5c66zpn0o0.webp"
                      alt="Snipaste_2022-02-15_15-44-11"
                ></p>
<p>然后我们就可以用上面案例的方法进行识别验证码</p>
<h4 id="识别实战"><a href="#识别实战" class="headerlink" title="识别实战"></a>识别实战</h4><p>现在，我们可以尝试使用自动化的方式识别验证码案例中的验证码，这里使用Selenium完成这个操作，代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> tesserocr</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preprocess</span>(<span class="params">image</span>):</span></span><br><span class="line">    image = image.convert(<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">    array = np.array(image)</span><br><span class="line">    array = np.where(array &gt; <span class="number">50</span>, <span class="number">255</span>, <span class="number">0</span>)</span><br><span class="line">    image = Image.fromarray(array.astype(<span class="string">&#x27;uint8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@retry(<span class="params">stop_max_attempt_number=<span class="number">10</span>, retry_on_result=<span class="keyword">lambda</span> x: x <span class="keyword">is</span> <span class="literal">False</span></span>)  </span><span class="comment"># 重试装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    browser.get(<span class="string">&#x27;https://captcha7.scrape.center/&#x27;</span>)</span><br><span class="line">    browser.find_element_by_css_selector(<span class="string">&#x27;.username input[type=&quot;text&quot;]&#x27;</span>).send_keys(<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">    browser.find_element_by_css_selector(<span class="string">&#x27;.password input[type=&quot;password&quot;]&#x27;</span>).send_keys(<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">    captcha = browser.find_element_by_css_selector(<span class="string">&#x27;#captcha&#x27;</span>)</span><br><span class="line">    image = Image.<span class="built_in">open</span>(BytesIO(captcha.screenshot_as_png))</span><br><span class="line">    image = preprocess(image)</span><br><span class="line">    captcha = tesserocr.image_to_text(image)</span><br><span class="line">    captcha = re.sub(<span class="string">&#x27;[^A-Za-z0-9]&#x27;</span>, <span class="string">&#x27;&#x27;</span>, captcha)</span><br><span class="line">    browser.find_element_by_css_selector(<span class="string">&#x27;.captcha input[type=&quot;text&quot;]&#x27;</span>).send_keys(captcha)</span><br><span class="line">    browser.find_element_by_css_selector(<span class="string">&#x27;.login&#x27;</span>).click()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        WebDriverWait(browser, <span class="number">10</span>).until(EC.presence_of_element_located((By.XPATH, <span class="string">&#x27;//h2[contains(., &quot;登录成功&quot;)]&#x27;</span>)))</span><br><span class="line">        time.sleep(<span class="number">10</span>)</span><br><span class="line">        browser.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> TimeoutException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    browser = webdriver.Chrome()</span><br><span class="line">    login()</span><br></pre></td></tr></table></figure>

<p>这里我们首先定义了一个prepeocess方法，用于对验证码图片做去噪处理，逻辑和前面是一样的，接着定义了一个login方法，其执行逻辑是:</p>
<ul>
<li>打开案例网站</li>
<li>找到用户名输入框，输入用户名</li>
<li>找到密码输入框，输入密码</li>
<li>找到并截取验证码图片，转化为图片对象</li>
<li>预处理验证码，去除噪声</li>
<li>识别验证码，得到识别结果</li>
<li>去除识别结果中的一些非字母字符和数字字符</li>
<li>找到验证码输入框，输入验证码结果</li>
<li>点击登录按钮</li>
<li>等待登录成功的字样出现，如果出现就说明识别正确，否则重复以上步骤</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>这里我们了解了tesserocr识别图片验证码的过程，我们发现这整体正确率不高</p>
<h3 id="使用OpenCV识别滑动验证码的缺口"><a href="#使用OpenCV识别滑动验证码的缺口" class="headerlink" title="使用OpenCV识别滑动验证码的缺口"></a>使用OpenCV识别滑动验证码的缺口</h3><p>随着互联网的发展，各种新型验证码层出不穷，最具有代表性的便是滑动验证码，接下来我们来看下滑动验证码</p>
<h4 id="滑动验证码"><a href="#滑动验证码" class="headerlink" title="滑动验证码"></a>滑动验证码</h4><p>滑动验证码，比较有代表性的服务商有极验、网易易盾等，如果我们想用自动话爬虫完成这一流程，关键步骤有两个:</p>
<ul>
<li>识别目标缺口的位置</li>
<li>将滑块拖到缺口位置</li>
</ul>
<p>其中第二步的实现方式有很多，例如<strong>可以用Selenium等自动化工具模拟这个流程，验证并登录成功后获取对应的Cookie或Token等信息，再进行后续操作</strong>，但这种方法的运行效率比较低；也可以直接逆向验证码背后的JavaScript逻辑，将缺口信息直接传给JavaScript代码，执行获取类似“密钥”信息的操作，再利用获取的“密钥”进行下一步操作，但这里出于某些安全方面i的考虑，我们不讲这种方式的具体实施方式，只会讲解第一步的技术问题</p>
<h4 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h4><p>这里我们会介绍使用OpenCV技术识别缺口的方法，输入一张带有缺口的验证码图片，输出标明缺口位置(一般是缺口左侧的横坐标)的图片</p>
<p>具体的步骤如下:</p>
<ul>
<li>对验证码图片进行高斯模糊滤波处理，消除部分噪声干扰</li>
<li>利用边缘检测算法，通过调整相应阈值识别出验证码图片中滑块的边缘</li>
<li>基于上一步得到的各个边缘轮廓信息，对比面积、位置、周长等特征，筛选出最有可能的轮廓</li>
</ul>
<h4 id="准备工作-1"><a href="#准备工作-1" class="headerlink" title="准备工作"></a>准备工作</h4><p>安装python-opencv库，安装方式如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-opencv</span><br></pre></td></tr></table></figure>

<p>若出现问题，可以参考<a class="link"   target="_blank" rel="noopener" href="https://setup.scrape.center/python-opencv" >https://setup.scrape.center/python-opencv<i class="fas fa-external-link-alt"></i></a></p>
<p>案例验证码图片地址: <a class="link"   target="_blank" rel="noopener" href="https://github.com/Python3WebSpider/CrackSlideCaptcha/blob/cv/captcha.png" >https://github.com/Python3WebSpider/CrackSlideCaptcha/blob/cv/captcha.png<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h4><h5 id="高斯滤波"><a href="#高斯滤波" class="headerlink" title="高斯滤波"></a>高斯滤波</h5><p>高斯滤波用来处理图片中的一些噪声，减少噪声干扰，其实就是把一张图片模糊化，为下一步的边缘检测做好铺垫</p>
<p>OpenCV提供了一个用于实现高斯模糊的方法，叫做CaussianBlur，其声明如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CaussianBlur</span>(<span class="params">src, ksize, dst=<span class="literal">None</span>, sigmaY=<span class="literal">None</span>, borderType=<span class="literal">None</span></span>)</span></span><br></pre></td></tr></table></figure>

<p>其中比较重要的参数如下:</p>
<ul>
<li>src: 需要处理的图片</li>
<li>ksize: 高斯滤波处理所用的高斯内核大小，需要传入一个元组，包含两个x和y两个元素</li>
<li>sigmaX: 高斯内核函数在X方向上的标准偏差</li>
<li>sigmaY: 高斯内核函数在Y方向上的标准偏差，如果sigmaY为0，就将它设为sigmaX；如果sigmaX和sigmaY都是0，就通过ksize计算出sigmaX和sigmaY</li>
<li>ksize和sigmaX是必传参数，对于上面给定的图片案例，ksize可以取做(5, 5)，sigmaX可以取作0，经过高斯滤波处理后，图片会变模糊</li>
</ul>
<h5 id="边缘检测"><a href="#边缘检测" class="headerlink" title="边缘检测"></a>边缘检测</h5><p>由于验证码图片中的目标缺口通常具有比较明显的边缘，所以借助一些边缘检测算法，再加上调整阈值是可以找出缺口位置的；目前比较应用广泛的边缘检测算法是Canny，OpenCV也实现了算法，方法名就叫做Canny，其声明如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Canny</span>(<span class="params">image, threshold1, threshold2, edges=<span class="literal">None</span>, apertureSize=<span class="literal">None</span>, L2gradient=<span class="literal">None</span></span>)</span></span><br></pre></td></tr></table></figure>

<p>其中比较重要的参数如下:</p>
<ul>
<li>image: 需要处理的图片</li>
<li>threshold1，threshold2: 两个阈值，分别是最小判定临界点和最大判定临界点</li>
<li>apertureSize: 用于查找图片渐变的索贝尔内核大小</li>
<li>L2gradient: 用于查找梯度幅度的等式</li>
</ul>
<p>通常来说，只需要设置threshold1，threshold2的值即可，其数值大小需要具体图片而定</p>
<h5 id="轮廓提取"><a href="#轮廓提取" class="headerlink" title="轮廓提取"></a>轮廓提取</h5><p>进行边缘检测处理之后，可以看到图片中会保留比较明显的边缘信息，下一步我们可以利用OpenCV技术提取出边缘的轮廓，这需要用到findContours方法</p>
<h5 id="外接矩形"><a href="#外接矩形" class="headerlink" title="外接矩形"></a>外接矩形</h5><p>提取到边缘轮廓后，可以计算出轮廓的外接矩形，以便我们根据目标面积和周长等参数判断提取到的轮廓是不是目标缺口的轮廓；计算外接矩形使用到的方法是boundingRect</p>
<h5 id="轮廓面积"><a href="#轮廓面积" class="headerlink" title="轮廓面积"></a>轮廓面积</h5><p>经过上面的处理，我们已经成功获取到了各个轮廓的外接矩形，很明显有些不是我们想要的，我们可以根据面积和周长等筛选缺口所在的位置，于是需要用到计算面积的方法contourArea</p>
<h5 id="轮廓周长"><a href="#轮廓周长" class="headerlink" title="轮廓周长"></a>轮廓周长</h5><p>使用方法arcLength</p>
<h5 id="缺口识别"><a href="#缺口识别" class="headerlink" title="缺口识别"></a>缺口识别</h5><p>定义实现高斯滤波，边缘检测和轮廓提取的三个方法</p>
<p>以上只是浅显地提了一下OpenCV的识别步骤，具体还得看文档: <a class="link"   target="_blank" rel="noopener" href="http://www.woshicver.com/" >http://www.woshicver.com/<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="使用深度学习识别图形验证码"><a href="#使用深度学习识别图形验证码" class="headerlink" title="使用深度学习识别图形验证码"></a>使用深度学习识别图形验证码</h3><p>在前面，我们了解了使用OCR技术和图像处理技术识别验证码的方法，当这些方法有个公同的缺点，那就是正确率不够高，下面，我们就来学习使用深度学习识别验证码的方法，包括对基本的图形验证码的识别和对滑块验证码缺口的识别</p>
<h4 id="准备工作-2"><a href="#准备工作-2" class="headerlink" title="准备工作"></a>准备工作</h4><p>由于本部分内容涉及深度学习相关的知识，所以在开始之前，我们要安装一个深度学习的框架，安装过程请访问: <a class="link"   target="_blank" rel="noopener" href="https://setup.scrape.center/pytorch%EF%BC%8C%E5%8F%A6%E5%A4%96%EF%BC%8C%E7%94%B1%E4%BA%8E%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%AD%E7%BB%83%E4%B8%80%E4%B8%AA%E8%AF%86%E5%88%AB%E5%9B%BE%E5%BD%A2%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9A%84%E6%A8%A1%E5%9E%8B%EF%BC%8C%E5%9B%A0%E6%AD%A4%E8%BF%98%E9%9C%80%E8%A6%81%E5%87%86%E5%A4%87%E4%B8%80%E4%BA%9B%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%EF%BC%9B%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E5%8F%88%E5%8C%85%E5%90%AB%E4%B8%A4%E9%83%A8%E5%88%86%EF%BC%8C%E4%B8%80%E9%83%A8%E5%88%86%E6%98%AF%E9%AA%8C%E8%AF%81%E7%A0%81%E5%9B%BE%E7%89%87%EF%BC%8C%E5%8F%A6%E4%B8%80%E9%83%A8%E6%98%AF%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9A%84%E7%9C%9F%E5%AE%9E%E6%A0%87%E6%B3%A8%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E9%AA%8C%E8%AF%81%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8%E8%87%AA%E8%A1%8C%E7%94%9F%E6%88%90%E4%B8%80%E4%BA%9B%E9%AA%8C%E8%AF%81%E7%A0%81%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%90%8C%E6%97%B6%E6%9C%89%E4%BA%86%E9%AA%8C%E8%AF%81%E7%A0%81%E5%9B%BE%E7%89%87%E5%92%8C%E6%A0%87%E6%B3%A8%E6%95%B0%E6%8D%AE%EF%BC%9B%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81%E5%9B%BE%E7%89%87%E9%9C%80%E8%A6%81%E7%94%A8%E5%88%B0%E4%B8%80%E4%B8%AA%E5%8F%AB%E5%81%9Acaptcha%E7%9A%84Python%E5%BA%93%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8pip3%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E8%BF%99%E4%B8%AA%E5%BA%93" >https://setup.scrape.center/pytorch，另外，由于需要使用深度学习训练一个识别图形验证码的模型，因此还需要准备一些训练模型；训练模型又包含两部分，一部分是验证码图片，另一部是验证码的真实标注，我们可以使用验证码生成器自行生成一些验证码，这样就同时有了验证码图片和标注数据；生成验证码图片需要用到一个叫做captcha的Python库，可以使用pip3工具安装这个库<i class="fas fa-external-link-alt"></i></a>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install captcha</span><br></pre></td></tr></table></figure>

<p>另外由于本节涉及的知识点都和深度学习模型的构建、训练，验证和推理过程相关联，同时伴随着数据集的准备过程，导致代码量太大，而我们的目标是训练出一个能够识别图形验证码的深度学习模型为爬虫所用，并不是侧重学习深度学习的原理，因此本节我们不会从零开始编写一个深度学习模型，我们点击下方链接跟着运行一遍即可，有兴趣再深入其中的原理，代码链接为: <a class="link"   target="_blank" rel="noopener" href="https://github.com/Python3WebSpider/DeepLearningImageCaptcha%EF%BC%8C%E6%88%91%E4%BB%AC%E4%BD%BF%E7%94%A8%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%E6%9D%A5%E5%85%8B%E9%9A%86" >https://github.com/Python3WebSpider/DeepLearningImageCaptcha，我们使用以下命令来克隆<i class="fas fa-external-link-alt"></i></a>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Python3WebSpider/DeepLearningImageCaptcha.git</span><br></pre></td></tr></table></figure>

<p>运行完毕之后，本地就会出现一个DeepLearningImageCaptcha，证明克隆成功</p>
<h4 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h4><p>一般我们的思维是，给我们一张验证码图片，然后我们再从验证码图片中获取验证码信息，但是我们数据准备的时候如果是这样的话那就需要太多人力和物力了，我们可以反其道而行之，先有验证码信息，然后再根据验证码信息生成验证码图片，所以生成验证码过程分为两步，第一步是生成随机的文本数据，第二步是根据生成的文本数据生成验证码图片，我们打开项目中的generate.py文件，其中定义了两个方法，generate_captcha_text和generate_captcha_text_and_image:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> captcha.image <span class="keyword">import</span> ImageCaptcha  <span class="comment"># pip install captcha</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> setting</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_captcha_text</span>():</span></span><br><span class="line">    captcha_text = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(setting.MAX_CAPTCHA):</span><br><span class="line">        c = random.choice(setting.ALL_CHAR_SET)</span><br><span class="line">        captcha_text.append(c)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(captcha_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_captcha_text_and_image</span>():</span></span><br><span class="line">    image = ImageCaptcha()</span><br><span class="line">    captcha_text = generate_captcha_text()</span><br><span class="line">    captcha_image = Image.<span class="built_in">open</span>(image.generate(captcha_text))</span><br><span class="line">    <span class="keyword">return</span> captcha_text, captcha_image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    count = <span class="number">3000</span></span><br><span class="line">    path = setting.EVAL_DATASET_PATH</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</span><br><span class="line">        os.makedirs(path)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">        now = <span class="built_in">str</span>(<span class="built_in">int</span>(time.time()))</span><br><span class="line">        text, image = generate_captcha_text_and_image()</span><br><span class="line">        filename = text + <span class="string">&#x27;_&#x27;</span> + now + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">        image.save(path + os.path.sep + filename)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;saved %d : %s&#x27;</span> % (i + <span class="number">1</span>, filename))</span><br></pre></td></tr></table></figure>

<p>这里的generate_captcha_text方法用于生成随机的文本数据，可以看到方法中定义了一个执行MAX_CAPTCHA次的for循环，每次循环都利用random.choice方法随即从ALL_CHAR_SET中挑选出一个字符并放入captcha_text，最后将captcha_text中的字符拼接在一起，其中MAX_CAPTCHA和ALL_CHAR_SET的定义在settings.py文件中，相应代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NUMBER = [<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>]</span><br><span class="line">ALPHABET = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>]</span><br><span class="line"></span><br><span class="line">ALL_CHAR_SET = NUMBER + ALPHABET</span><br><span class="line">ALL_CHAR_SET_LEN = <span class="built_in">len</span>(ALL_CHAR_SET)</span><br><span class="line">MAX_CAPTCHA = <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>可以看到MAX_CAPTCHA的值是4，所以最后拼接而成的就是4位验证码，ALL_CHAR_SET的值是十位数字和26个字母构成的列表，所以拼接而成的验证码文件就是4为数字和字母的组和</p>
<p>接下来我们修改generate.py文件，先生成一批训练数据，这里生成10万个验证码，这里需要修改的是conunt变量和path变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">count  = <span class="number">100000</span></span><br><span class="line">path = setting.TRAIN_DATASET_PATH</span><br></pre></td></tr></table></figure>

<ul>
<li>TRAIN_DATASET_PATH: 训练集所在路径，数据用于模型的训练</li>
<li>EVAL_DATASET_PATH: 验证集所在路径，一般在训练过程中或训练完毕后用到，可用于验证模型的训练效果</li>
<li>PREDICT_DATASET_PATH: 推理集，一般在训练完毕后用到，可用于模型推理和测试</li>
</ul>
<p>然后我们运行以下命令生成训练集:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 generate.py</span><br></pre></td></tr></table></figure>

<p>这里就生成了非常多的验证码数据，标注结果直接出现在文件名中，最终生成的训练集数据如下图所示:</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/bFDVPI"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://s4.ax1x.com/2022/02/24/bFDVPI.png"
                      alt="bFDVPI.png"
                ></a></p>
<p>利用同样的方法，可以生成验证集，用于验证模型的训练效果，还是修改count变量和path变量:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="number">3000</span></span><br><span class="line">path = setting.EVAL_DATASET_PATH</span><br></pre></td></tr></table></figure>

<p>验证集不用那么大，count为3000就够了，path修改为以上的路径，然后重新运行generate.py文件里面的代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 generate.py</span><br></pre></td></tr></table></figure>

<p>这样就生成了验证集的数据，如下图所示:</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/bFDuM8"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://s4.ax1x.com/2022/02/24/bFDuM8.png"
                      alt="bFDuM8.png"
                ></a></p>
<p>数据都准备好之后，就可以开始训练模型了</p>
<h4 id="模型训练"><a href="#模型训练" class="headerlink" title="模型训练"></a>模型训练</h4><p>本节中我们使用的是深度学习模型是一个基本的CNN模型，模型定义在model.py文件中，定义如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> setting</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># CNN Model (2 conv layer)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CNN</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(CNN, self).__init__()</span><br><span class="line">        self.layer1 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">1</span>, <span class="number">32</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.BatchNorm2d(<span class="number">32</span>),</span><br><span class="line">            nn.Dropout(<span class="number">0.5</span>),  <span class="comment"># drop 50% of the neuron</span></span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>))</span><br><span class="line">        self.layer2 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.BatchNorm2d(<span class="number">64</span>),</span><br><span class="line">            nn.Dropout(<span class="number">0.5</span>),  <span class="comment"># drop 50% of the neuron</span></span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>))</span><br><span class="line">        self.layer3 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">64</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            nn.BatchNorm2d(<span class="number">64</span>),</span><br><span class="line">            nn.Dropout(<span class="number">0.5</span>),  <span class="comment"># drop 50% of the neuron</span></span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>))</span><br><span class="line">        self.fc = nn.Sequential(</span><br><span class="line">            nn.Linear((setting.IMAGE_WIDTH // <span class="number">8</span>) * (setting.IMAGE_HEIGHT // <span class="number">8</span>) * <span class="number">64</span>, <span class="number">1024</span>),</span><br><span class="line">            nn.Dropout(<span class="number">0.5</span>),  <span class="comment"># drop 50% of the neuron</span></span><br><span class="line">            nn.ReLU())</span><br><span class="line">        self.rfc = nn.Sequential(</span><br><span class="line">            nn.Linear(<span class="number">1024</span>, setting.MAX_CAPTCHA * setting.ALL_CHAR_SET_LEN),</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        out = self.layer1(x)</span><br><span class="line">        out = self.layer2(out)</span><br><span class="line">        out = self.layer3(out)</span><br><span class="line">        out = out.view(out.size(<span class="number">0</span>), -<span class="number">1</span>)</span><br><span class="line">        out = self.fc(out)</span><br><span class="line">        out = self.rfc(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>

<p>可以看到这里定义了三层，每一层都是Conv2d(卷积)、BatchNorm2d(批标准化)、Dropout(随机失活)、ReLU(激活函数)、MaxPool2d(池话)的组合，经过这三层处理后，由一个全连接网络层输出最终的结果，用于计算模型的最终损失</p>
<p>模型的训练过程定义在train.py文件中，整个训练逻辑是这样的:</p>
<ul>
<li>引入定义好的模型，即model.py，对模型进行初始化</li>
<li>定义损失函数loss</li>
<li>定义优化器optimizer</li>
<li>加载数据，一般包括训练集数据和验证集数据</li>
<li>执行训练，这个过程包括反向求导、模型权重更新</li>
<li>在执行完特定的训练步数后，验证和保存模型</li>
</ul>
<p>了解了基本的逻辑之后，就可以尝试用现有的数据训练一个深度学习模型了，怎么训练呢，运行训练模型，即train.py即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 train.py</span><br></pre></td></tr></table></figure>

<p>训练过程的输出结果如下，可以看到训练过程中模型的损失在不断降低，说明模型在不断学习和优化，同时每训练完一个轮次之后都会执行一次模型验证；由于在训练模型时没有使用验证集数据，所以用验证集数据来验证是可以得到模型的真实正确率的，是更为科学的</p>
<p>另外在每次的验证中，还会保存最优的验证结果以及最优的模型，存为best_model.pkl文件</p>
<p>推荐使用GPU来训练模型，速度会比不用GPU快很多，关于如何设置用GPU训练模型，可以参考PyTorch官方教程，这里不再赘述</p>
<p>经过一段时间的训练，模型的损失趋近于0，训练的正确率在不断上升，验证的正确率能到到96%以上，最后可以在本地上看到一个best_model.pkl文件，这便是我们想要的模型</p>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>现在我们来测试下得到的模型，先在PREDICT_DATASET_PATH变量对应的路径下生成几个验证码图片，生成过程前面也讲到过，这里随意选择两个验证码图片放在那个路径下，然后在predict.py文件中加载上面得到的模型best_model.pkl，关键代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnn.load_state_dict(torch.load(<span class="string">&#x27;best_model.pkl&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>并根据加载的模型对定义的CNN模型的权重进行初始化，整个模型加载完毕之后，就和刚才训练时一样强大，拥有识别图形验证码的能力</p>
<p>运行predict.py文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 predict.py</span><br></pre></td></tr></table></figure>

<p>然后我们就能看到识别的结果了</p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：</li>
        <li>Post author：Lhj</li>
        <li>Create time：2022-02-14 23:35:14</li>
        <li>
            Post link：https://keep.xpoet.cn/2022/02/14/Python3网络爬虫开发实战第二版第8章-验证码的识别/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/02/15/Python3%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E7%AC%AC%E4%BA%8C%E7%89%88%E7%AC%AC9%E7%AB%A0-%E4%BB%A3%E7%90%86%E7%9A%84%E4%BD%BF%E7%94%A8/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Python3网络爬虫开发实战第二版第9章-代理的使用</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/02/11/Python3%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E7%AC%AC%E4%BA%8C%E7%89%88%E7%AC%AC7%E7%AB%A0-JavaScript%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E9%A1%B5%E9%9D%A2%E6%8A%93%E5%8F%96/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Python3网络爬虫开发实战第二版第7章-JavaScript动态渲染页面抓取</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;Comments</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'nIcO1O6cSVuRH8EROCWwNFWN-gzGzoHsz',
                    appKey: 'qrglokTeum8DXiYRzM4k4NF4',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '😜 尽情吐槽吧~',
                    lang: 'en'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'Lhj';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Lhj</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8OCR%E6%8A%80%E6%9C%AF%E8%AF%86%E5%88%AB%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">1.</span> <span class="nav-text">使用OCR技术识别图片验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OCR%E6%8A%80%E6%9C%AF"><span class="nav-number">1.1.</span> <span class="nav-text">OCR技术</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">1.2.</span> <span class="nav-text">准备工作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98%E9%AA%8C%E8%AF%81%E7%A0%81%E5%9B%BE%E7%89%87"><span class="nav-number">1.3.</span> <span class="nav-text">保存验证码图片</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%86%E5%88%AB%E6%B5%8B%E8%AF%95"><span class="nav-number">1.4.</span> <span class="nav-text">识别测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%86%E5%88%AB%E8%AF%AF%E5%B7%AE%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">1.5.</span> <span class="nav-text">识别误差的处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%86%E5%88%AB%E5%AE%9E%E6%88%98"><span class="nav-number">1.6.</span> <span class="nav-text">识别实战</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.7.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8OpenCV%E8%AF%86%E5%88%AB%E6%BB%91%E5%8A%A8%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9A%84%E7%BC%BA%E5%8F%A3"><span class="nav-number">2.</span> <span class="nav-text">使用OpenCV识别滑动验证码的缺口</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BB%91%E5%8A%A8%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">2.1.</span> <span class="nav-text">滑动验证码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="nav-number">2.2.</span> <span class="nav-text">基本原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C-1"><span class="nav-number">2.3.</span> <span class="nav-text">准备工作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">2.4.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%AB%98%E6%96%AF%E6%BB%A4%E6%B3%A2"><span class="nav-number">2.4.1.</span> <span class="nav-text">高斯滤波</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BE%B9%E7%BC%98%E6%A3%80%E6%B5%8B"><span class="nav-number">2.4.2.</span> <span class="nav-text">边缘检测</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AE%E5%BB%93%E6%8F%90%E5%8F%96"><span class="nav-number">2.4.3.</span> <span class="nav-text">轮廓提取</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%96%E6%8E%A5%E7%9F%A9%E5%BD%A2"><span class="nav-number">2.4.4.</span> <span class="nav-text">外接矩形</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AE%E5%BB%93%E9%9D%A2%E7%A7%AF"><span class="nav-number">2.4.5.</span> <span class="nav-text">轮廓面积</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AE%E5%BB%93%E5%91%A8%E9%95%BF"><span class="nav-number">2.4.6.</span> <span class="nav-text">轮廓周长</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%BA%E5%8F%A3%E8%AF%86%E5%88%AB"><span class="nav-number">2.4.7.</span> <span class="nav-text">缺口识别</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AF%86%E5%88%AB%E5%9B%BE%E5%BD%A2%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">3.</span> <span class="nav-text">使用深度学习识别图形验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C-2"><span class="nav-number">3.1.</span> <span class="nav-text">准备工作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="nav-number">3.2.</span> <span class="nav-text">数据准备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83"><span class="nav-number">3.3.</span> <span class="nav-text">模型训练</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">3.4.</span> <span class="nav-text">测试</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
