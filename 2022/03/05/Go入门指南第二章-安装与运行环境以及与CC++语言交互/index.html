<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Lhj">
    
    <title>
        
            Go入门指南第二章-安装与运行环境以及与C/C++语言交互 |
        
        Alexander
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Alexander
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                NOTE
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">NOTE</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Go入门指南第二章-安装与运行环境以及与C/C++语言交互</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Lhj</span>
                        
                            <span class="author-label">Lv6</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-03-05 16:54:30</span>
        <span class="mobile">2022-03-05 16:54</span>
    </span>
    
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>3.9k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>14 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h4><p>国情原因 <a class="link"   target="_blank" rel="noopener" href="https://golang.org/" >https://golang.org/<i class="fas fa-external-link-alt"></i></a> 偶尔会访问不了，新手要下载 Go 官方的提供的安装包经常会受阻。解决方法是使用可信任的其他镜像进行下载，推荐这两个:</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://golang.google.cn/dl/" >https://golang.google.cn/dl/<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="https://gomirrors.org/" >https://gomirrors.org/<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<p>打开给定的链接我们会看到如下图片:</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/stormwasd/image-hosting@master/20220305/Snipaste_2022-03-05_17-03-55.4yha93wkms40.webp"
                      alt="Snipaste_2022-03-05_17-03-55"
                ></p>
<p>然后我们可以点击Download下载go的安装包</p>
<p>在win下:</p>
<p>下载后直接双击msi文件安装，默认安装在C:\Program Files\Go，安装完成后默认会在环境变量Path后添加Go安装目录下的bin目录C:\Program Files\Go\bin\，并添加环境变量GOROOT，值为Go安装根目录C:\Program Files\Go\</p>
<p>验证是否安装成功，在运行中输入 cmd 打开命令行工具，在提示符下输入 go env，出现以下画面就是安装成功:</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.jsdelivr.net/gh/stormwasd/image-hosting@master/20220305/Snipaste_2022-03-05_17-27-52.yre88dgn9q8.webp"
                      alt="Snipaste_2022-03-05_17-27-52"
                ></p>
<h4 id="配置代理"><a href="#配置代理" class="headerlink" title="配置代理"></a>配置代理</h4><p>添加国内代理，否则很多包无法下载:</p>
<p>将Go默认的代理替换为以下代理:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go env -w GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure>

<h4 id="IDE的选择"><a href="#IDE的选择" class="headerlink" title="IDE的选择"></a>IDE的选择</h4><p>目前可选的IDE有很多，如VsCode，goland，subline等，我推荐使用goland，然后去安装一些插件</p>
<h4 id="安装目录清单"><a href="#安装目录清单" class="headerlink" title="安装目录清单"></a>安装目录清单</h4><p>你的 Go 安装目录（ $GOROOT ）的文件夹结构应该如下所示:</p>
<p>README.md, AUTHORS, CONTRIBUTORS, LICENSE，然后就是以下的一些文件:</p>
<ul>
<li>/bin: 包含可执行文件，如: 编译器，Go 工具</li>
<li>/doc: 包含示例程序，代码工具，本地文档等</li>
<li>/lib: 包含文档模版</li>
<li>/misc: 包含与支持Go编辑器有关的配置文件以及 cgo 的示例</li>
<li>/os_arch: 包含标准库的包的对象文件（ .a ）</li>
<li>/src: 包含源代码构建脚本和标准库的包的完整源代码（Go 是一门开源语言）</li>
<li>/src/cmd: 包含 Go 和 C 的编译器和命令行脚本</li>
</ul>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><h4 id="Go运行时-runtime"><a href="#Go运行时-runtime" class="headerlink" title="Go运行时(runtime)"></a>Go运行时(runtime)</h4><p>尽管 Go 编译器产生的是本地可执行代码，这些代码仍旧运行在Go的 runtime（这部分的代码可以在<br>runtime包中找到）当中。这个 runtime类似Java和.NET语言所用到的虚拟机，它负责管理包括内存<br>分配、垃圾回收、栈处理、goroutine、channel、切片（slice）、map 和反射<br>（reflection）等等。<br>runtime 主要由 C 语言编写（Go 1.5 开始自举），并且是每个 Go 包的最顶级包。你可以在目录<br>$GOROOT/src/runtime 中找到相关内容。<br>垃圾回收器 Go 拥有简单却高效的标记-清除回收器。它的主要思想来源于 IBM 的可复用垃圾回收器，旨<br>在打造一个高效、低延迟的并发回收器。目前 gccgo 还没有回收器，同时适用 gc 和 gccgo 的新回收器<br>正在研发中。使用一门具有垃圾回收功能的编程语言不代表你可以避免内存分配所带来的问题，分配和回收内容都是消耗 CPU 资源的一种行为</p>
<p>Go 的可执行文件都比相对应的源代码文件要大很多，这恰恰说明了 Go 的 runtime 嵌入到了每一个可执<br>行文件当中。当然，在部署到数量巨大的集群时，较大的文件体积也是比较头疼的问题。但总得来说，Go<br>的部署工作还是要比 Java 和 Python 轻松得多。因为 Go 不需要依赖任何其它文件，它只需要一个单独的<br>静态文件，这样你也不会像使用其它语言一样在各种不同版本的依赖文件之间混淆。</p>
<h4 id="Go解释器"><a href="#Go解释器" class="headerlink" title="Go解释器"></a>Go解释器</h4><p>因为 Go 具有像动态语言那样快速编译的能力，自然而然地就有人会问 Go 语言能否在 REPL（read-eval-print loop）编程环境下实现。Sebastien Binet 已经使用这种环境实现了一个 Go 解释器，你可以在这个页面找到：<a class="link"   target="_blank" rel="noopener" href="https://github.com/sbinet/igo%E3%80%82" >https://github.com/sbinet/igo。<i class="fas fa-external-link-alt"></i></a></p>
<p>什么是REPL编程环境: <a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39839745/article/details/86499612" >https://blog.csdn.net/qq_39839745/article/details/86499612<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="格式化代码"><a href="#格式化代码" class="headerlink" title="格式化代码"></a>格式化代码</h4><p>Go 开发团队不想要 Go 语言像许多其它语言那样总是在为代码风格而引发无休止的争论，浪费大量宝贵<br>的开发时间，因此他们制作了一个工具： go fmt （ gofmt ）。这个工具可以将你的源代码格式化成符合<br>官方统一标准的风格，属于语法风格层面上的小型重构。遵循统一的代码风格是 Go 开发中无可撼动的铁<br>律，因此你必须在编译或提交版本管理系统之前使用 gofmt 来格式化你的代码。<br>尽管这种做法也存在一些争论，但使用 gofmt 后你不再需要自成一套代码风格而是和所有人使用相同的<br>规则。这不仅增强了代码的可读性，而且在接手外部 Go 项目时，可以更快地了解其代码的含义。此外，<br>大多数开发工具也都内置了这一功能。<br>Go 对于代码的缩进层级方面使用 tab 还是空格并没有强制规定，一个 tab 可以代表 4 个或 8 个空格。在<br>实际开发中，1 个 tab 应该代表 4 个空格，而在本身的例子当中，每个 tab 代表 8 个空格。至于开发工<br>具方面，一般都是直接使用 tab 而不替换成空格。<br>在命令行输入 gofmt –w program.go 会格式化该源文件的代码然后将格式化后的代码覆盖原始内容<br>（如果不加参数 -w 则只会打印格式化后的结果而不重写文件）； gofmt -w *.go 会格式化并重写所有<br>Go 源文件； gofmt map1 会格式化并重写 map1 目录及其子目录下的所有 Go 源文件。<br>gofmt 也可以通过在参数 -r 后面加入用双引号括起来的替换规则实现代码的简单重构，规则的格式：<br>&lt;原始内容&gt; -&gt; &lt;替换内容&gt; </p>
<p>实例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gofmt -r “(a) -&gt; a” –w *.go</span><br></pre></td></tr></table></figure>

<p>上面的代码会将源文件中没有意义的括号去掉</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gofmt -r “a[n:<span class="built_in">len</span>(a)] -&gt; a[n:]” –w *.go</span><br></pre></td></tr></table></figure>

<p>上面的代码会将源文件中多余的 len(a) 去掉</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gofmt –r ‘A.Func1(a,b) -&gt; A.Func2(b,a)’ –w *.go</span><br></pre></td></tr></table></figure>

<p>上面的代码会将源文件中符合条件的函数的参数调换位置</p>
<p>如果想要了解有关 gofmt 的更多信息，请访问该页面：<a class="link"   target="_blank" rel="noopener" href="http://golang.org/cmd/gofmt/" >http://golang.org/cmd/gofmt/<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="生成代码文档"><a href="#生成代码文档" class="headerlink" title="生成代码文档"></a>生成代码文档</h4><p>go doc 工具会从 Go 程序和包文件中提取顶级声明的首行注释以及每个对象的相关注释，并生成相关文<br>档</p>
<p>它也可以作为一个提供在线文档浏览的 web 服务器，<a class="link"   target="_blank" rel="noopener" href="http://golang.org/" >http://golang.org<i class="fas fa-external-link-alt"></i></a> 就是通过这种形式实现的</p>
<p>一般用法:</p>
<ul>
<li>go doc package: </li>
<li>例如： go doc fmt 会显示使用 godoc 生成的 fmt 包的文档注释</li>
<li>go doc package/subpackage: 获取子包的文档注释，例如： go doc container/list</li>
<li>go doc package function: 获取某个函数在某个包中的文档注释，例如： go doc fmt Printf 会显<br>示有关 fmt.Printf() 的使用说明</li>
</ul>
<p>这个工具只能获取在 Go 安装目录下 …/go/src 中的注释内容。此外，它还可以作为一个本地文档浏览<br>web 服务器。在命令行输入 godoc -http=:6060 ，然后使用浏览器打开 <a class="link"   target="_blank" rel="noopener" href="http://localhost:6060/" >http://localhost:6060<i class="fas fa-external-link-alt"></i></a> 后，你<br>就可以看到本地文档浏览服务器提供的页面。<br>godoc 也可以用于生成非标准库的 Go 源码文件的文档注释，在后面我们会介绍</p>
<p>如果想要获取更多有关 godoc 的信息，请访问该页面：<a class="link"   target="_blank" rel="noopener" href="http://golang.org/cmd/godoc/" >http://golang.org/cmd/godoc/<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="其他工具"><a href="#其他工具" class="headerlink" title="其他工具"></a>其他工具</h4><ul>
<li>go install: 是安装 Go 包的工具，类似 Ruby 中的 rubygems。主要用于安装非标准库的包文件，将<br>源代码编译成对象文件</li>
<li>go fix: 用于将你的 Go 代码从旧的发行版迁移到最新的发行版，它主要负责简单的、重复的、枯燥无<br>味的修改工作，如果像 API 等复杂的函数修改，工具则会给出文件名和代码行数的提示以便让开发人员快速定位并升级代码。Go 开发团队一般也使用这个工具升级 Go 内置工具以及 谷歌内部项目的代码。 go fix 之所以能够正常工作是因为 Go 在标准库就提供生成抽象语法树和通过抽象语法树对代码进行还原的功能。该工具会尝试更新当前目录下的所有 Go 源文件，并在完成代码更新后在控制台输出相关的文件名称</li>
<li>go test 是一个轻量级的单元测试框架（第 13 章）</li>
</ul>
<h4 id="Go性能说明"><a href="#Go性能说明" class="headerlink" title="Go性能说明"></a>Go性能说明</h4><p>根据 Go 开发团队和基本的算法测试，Go 语言与 C 语言的性能差距大概在 10%~20% 之间（ 译者注：<br>由于出版时间限制，该数据应为 2013 年 3 月 28 日之前产生 ）。虽然没有官方的性能标准，但是与其它<br>各个语言相比已经拥有非常出色的表现。<br>如果说 Go 语言的执行效率大约比 C++ 慢 20% 也许更有实际意义。保守估计在相同的环境和执行目标的<br>情况下，Go 程序比 Java 或 Scala 应用程序要快上 2 倍，并比这两门语言使用少占用 70% 的内存。在很<br>多情况下这种比较是没有意义的，因为像谷歌这样拥有成千上万台服务器的公司都抛弃 C++ 而开始将 Go用于生产环境已经足够说明它本身所具有的优势。<br>时下流行的语言大都是运行在虚拟机上，如：Java 和 Scala 使用的 JVM，C# 和 VB.NET 使用的 .NET<br>CLR。尽管虚拟机的性能已经有了很大的提升，但任何使用 JIT 编译器和脚本语言解释器的编程语言<br>（Ruby、Python、Perl 和 JavaScript）在 C 和 C++ 的绝对优势下甚至都无法在性能上望其项背。<br>如果说 Go 比 C++ 要慢 20%，那么 Go 就要比任何非静态和编译型语言快 2 到 10 倍，并且能够更加高<br>效地使用内存。其实比较多门语言之间的性能是一种非常猥琐的行为，因为任何一种语言都有其所擅长和薄弱的方面。例如在处理文本方面，那些只处理纯字节的语言显然要比处理 Unicode 这种更为复杂编码的语言要出色的多。有些人可能认为使用两种不同的语言实现同一个目标能够得出正确的结论，但是很多时候测试者可能对一门语言非常了解而对另一门语言只是大概明白，测试者对程序编写的手法在一定程度也会影响结果的公平性，因此测试程序应该分别由各自语言的擅长者来编写，这样才能得到具有可比性的结果。另外，像在统计学方面，人们很难避免人为因素对结果的影响，所以这在严格意义上并不是科学。还要注意的是，测试结果的可比性还要根据测试目标来区别，例如很多发展十多年的语言已经针对各类问题拥有非常成熟的类库，而作为一门新生语言的 Go 语言，并没有足够的时间来推导各类问题的最佳解决方案。</p>
<ul>
<li><p>比较 Go 和 Python 在简单的 web 服务器方面的性能，单位为传输量每秒:</p>
<p>原生的 Go http 包要比 web.py 快 7 至 8 倍，如果使用 web.go 框架则稍微差点，比 web.py 快 6<br>至 7 倍。在 Python 中被广泛使用的 tornado 异步服务器和框架在 web 环境下要比 web.py 快很<br>多，Go 大概只比它快 1.2 至 1.5 倍</p>
</li>
<li><p>Go 和 Python 在一般开发的平均水平测试中，Go 要比 Python 3 快 25 倍左右，少占用三分之二的<br>内存，但比 Python 大概多写一倍的代码</p>
</li>
</ul>
<h4 id="与其他语言进行交互"><a href="#与其他语言进行交互" class="headerlink" title="与其他语言进行交互"></a>与其他语言进行交互</h4><h4 id="与C进行交互"><a href="#与C进行交互" class="headerlink" title="与C进行交互"></a>与C进行交互</h4><p>工具 cgo 提供了对 FFI（外部函数接口）的支持，能够使用 Go 代码安全地调用 C 语言库，你可以访问<br>cgo 文档主页：<a class="link"   target="_blank" rel="noopener" href="http://golang.org/cmd/cgo%E3%80%82cgo" >http://golang.org/cmd/cgo。cgo<i class="fas fa-external-link-alt"></i></a> 会替代 Go 编译器来产生可以组合在同一个包中的<br>Go 和 C 代码。在实际开发中一般使用 cgo 创建单独的 C 代码包</p>
<p>如果你想要在你的 Go 程序中使用 cgo，则必须在单独的一行使用 import “C” 来导入，一般来说你可能<br>还需要 import “unsafe”</p>
<p>然后，你可以在 import “C” 之前使用注释（单行或多行注释均可）的形式导入 C 语言库（甚至有效的<br>C 语言代码），它们之间没有空行，例如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// <span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line">// <span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br></pre></td></tr></table></figure>

<p>名称 “C” 并不属于标准库的一部分，这只是 cgo 集成的一个特殊名称用于引用 C 的命名空间。在这个命<br>名空间里所包含的 C 类型都可以被使用，例如 C.uint 、 C.long 等等，还有 libc 中的函数，C.random() 等也可以被调用</p>
<p>当你想要使用某个类型作为 C 中函数的参数时，必须将其转换为 C 中的类型，反之亦然，例如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var i <span class="built_in">int</span></span><br><span class="line">C.uint(i) // 从 Go 中的 <span class="built_in">int</span> 转换为 C 中的无符号 <span class="built_in">int</span></span><br><span class="line"><span class="built_in">int</span>(C.random()) // 从 C 中 random() 函数返回的 long 转换为 Go 中的 <span class="built_in">int</span></span><br></pre></td></tr></table></figure>

<p>下面的 2 个 Go 函数 Random() 和 Seed() 分别调用了 C 中的 C.random() 和 C.srandom():</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package rand</span><br><span class="line">// <span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">func Random() <span class="built_in">int</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">int</span>(C.random())</span><br><span class="line">&#125;</span><br><span class="line">func Seed(i <span class="built_in">int</span>) &#123;</span><br><span class="line">C.srandom(C.uint(i))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>C 当中并没有明确的字符串类型，如果你想要将一个 string 类型的变量从 Go 转换到 C 时，可以使用<br>C.CString(s) ；同样，可以使用 C.GoString(cs) 从 C 转换到 Go 中的 string 类型</p>
<p>Go 的内存管理机制无法管理通过 C 代码分配的内存</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defer C.free(unsafe.Pointer(Cvariable))</span><br></pre></td></tr></table></figure>

<p>这一行最好紧跟在使用 C 代码创建某个变量之后，这样就不会忘记释放内存了。下面的代码展示了如何使用 cgo 创建变量、使用并释放其内存</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package <span class="built_in">print</span></span><br><span class="line">// <span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line">// <span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;unsafe&quot;</span></span><br><span class="line">func Print(s string) &#123;</span><br><span class="line">cs := C.CString(s)</span><br><span class="line">defer C.free(unsafe.Pointer(cs))</span><br><span class="line">C.fputs(cs, (*C.FILE)(C.stdout))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="与C-进行交互"><a href="#与C-进行交互" class="headerlink" title="与C++进行交互"></a>与C++进行交互</h4><p>SWIG（简化封装器和接口生成器）支持在 Linux 系统下使用 Go 代码调用 C 或者 C++ 代码。这里有一<br>些使用 SWIG 的注意事项:</p>
<ul>
<li>编写需要封装的库的 SWIG 接口</li>
<li>SWIG 会产生 C 的存根函数</li>
<li>这些库可以使用 cgo 来调用</li>
<li>相关的 Go 文件也可以被自动生成这类接口支持方法重载、多重继承以及使用 Go 代码实现 C++ 的抽象类，目前使用 SWIG 存在的一个问题是它无法支持所有的 C++ 库，比如说它就无法解析TObject.h</li>
</ul>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：Go入门指南第二章-安装与运行环境以及与C/C++语言交互</li>
        <li>Post author：Lhj</li>
        <li>Create time：2022-03-05 16:54:30</li>
        <li>
            Post link：https://keep.xpoet.cn/2022/03/05/Go入门指南第二章-安装与运行环境以及与CC++语言交互/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2022/03/07/%E8%8F%9C%E9%B8%9F%E6%95%99%E7%A8%8B%E4%B8%8A%E7%9A%84JavaScript%E6%B5%8B%E9%AA%8C/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">菜鸟教程上的JavaScript测验</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/03/05/Go%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E7%AC%AC%E4%B8%80%E7%AB%A0-Go%E8%AF%AD%E8%A8%80%E7%9A%84%E8%B5%B7%E6%BA%90/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Go入门指南第一章-Go语言的起源</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;Comments</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'nIcO1O6cSVuRH8EROCWwNFWN-gzGzoHsz',
                    appKey: 'qrglokTeum8DXiYRzM4k4NF4',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '😜 尽情吐槽吧~',
                    lang: 'en'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'Lhj';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Lhj</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">1.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85"><span class="nav-number">1.1.</span> <span class="nav-text">下载安装包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86"><span class="nav-number">1.2.</span> <span class="nav-text">配置代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IDE%E7%9A%84%E9%80%89%E6%8B%A9"><span class="nav-number">1.3.</span> <span class="nav-text">IDE的选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95%E6%B8%85%E5%8D%95"><span class="nav-number">1.4.</span> <span class="nav-text">安装目录清单</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C"><span class="nav-number">2.</span> <span class="nav-text">运行</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Go%E8%BF%90%E8%A1%8C%E6%97%B6-runtime"><span class="nav-number">2.1.</span> <span class="nav-text">Go运行时(runtime)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Go%E8%A7%A3%E9%87%8A%E5%99%A8"><span class="nav-number">2.2.</span> <span class="nav-text">Go解释器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%BB%A3%E7%A0%81"><span class="nav-number">2.3.</span> <span class="nav-text">格式化代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E6%96%87%E6%A1%A3"><span class="nav-number">2.4.</span> <span class="nav-text">生成代码文档</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7"><span class="nav-number">2.5.</span> <span class="nav-text">其他工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Go%E6%80%A7%E8%83%BD%E8%AF%B4%E6%98%8E"><span class="nav-number">2.6.</span> <span class="nav-text">Go性能说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E8%AF%AD%E8%A8%80%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92"><span class="nav-number">2.7.</span> <span class="nav-text">与其他语言进行交互</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8EC%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92"><span class="nav-number">2.8.</span> <span class="nav-text">与C进行交互</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8EC-%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92"><span class="nav-number">2.9.</span> <span class="nav-text">与C++进行交互</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
